# $Id: Imakefile,v 1.43 1998-05-17 03:51:42 ghudson Exp $

#ifdef SOLARIS
MACHDEFS=-DSOLARIS_MAE
MACHLIBS=-lbsd
#endif

#ifdef sgi
/* AFS 3.4a rx depends on sys now; sys already depended on rx */
MACHLIBS = ../misc/libnanny.a
#endif

KRB5_DEFS = -DKRB5

DEFINES = -DSETPAG $(KRB5_DEFS) $(MACHDEFS)
AFSLIBS = -L$(AFSDIR)/lib -L$(AFSDIR)/lib/afs -lsys -lrx -llwp -lsys


SRCS = xlogin.c verify.c SmeBSB.c StringToPixel.c Clock.c
OBJS = xlogin.o verify.o SmeBSB.o StringToPixel.o Clock.o
LIBS = -lWc -lXp -lXmu -lXaw -lXt -lXext -lX11 -lal -lkrb4 -ldes425 -lkrb5 \
	-lcrypto -lhesiod $(AFSLIBS) $(MACHLIBS) -lcom_err -lm

#ifdef SOLARIS
PRESOURCES=Xlogin.sun4.presed
#endif
#ifdef sgi
PRESOURCES=Xlogin.s/**/gi.presed
#endif

create_dir(/etc/athena/login)
create_dir(/etc/athena/login/bitmaps)
SimpleProgram(timeout,timeout.o,,$(ATHBINDIR))

static_program(xlogin,$(OBJS),,$(LIBS))
install_program(xlogin,-s,$(ATHRETCDIR)/xlogin)
install_program(xlogin,,$(ATHRETCDIR)/xlogin.unstripped)

all::	Xlogin
install:: Xlogin

Xlogin: $(PRESOURCES) $(ATHVERS)
	. $(ATHVERS); \
	sed -e "s/ATHENA_VERSION/$$major.$$minor/" \
		-e "s:MOTD_FILE:/afs/athena.mit.edu/system/config/motd/login.$$major$$minor:" \
		$(PRESOURCES) > Xlogin

install_file(bitmaps/check,/etc/athena/login/bitmaps/check)
install_file(bitmaps/question,/etc/athena/login/bitmaps/question)
install_file(bitmaps/warning,/etc/athena/login/bitmaps/warning)
install_file(bitmaps/white,/etc/athena/login/bitmaps/white)
install_file(bitmaps/owl,/etc/athena/login/bitmaps/owl)
install_file(bitmaps/owleyes0.xbm,/etc/athena/login/bitmaps/owleyes0.xbm)
install_file(bitmaps/owleyes1.xbm,/etc/athena/login/bitmaps/owleyes1.xbm)
install_file(bitmaps/owleyes2.xbm,/etc/athena/login/bitmaps/owleyes2.xbm)
install_file(bitmaps/owleyes3.xbm,/etc/athena/login/bitmaps/owleyes3.xbm)
install_file(bitmaps/owleyes4.xbm,/etc/athena/login/bitmaps/owleyes4.xbm)
install_file(bitmaps/owleyes5.xbm,/etc/athena/login/bitmaps/owleyes5.xbm)
install_file(bitmaps/is,/etc/athena/login/bitmaps/is)
install_file(bitmaps/is0.xbm,/etc/athena/login/bitmaps/is0.xbm)
install_file(bitmaps/is1.xbm,/etc/athena/login/bitmaps/is1.xbm)
install_file(bitmaps/is2.xbm,/etc/athena/login/bitmaps/is2.xbm)
install_file(bitmaps/is3.xbm,/etc/athena/login/bitmaps/is3.xbm)
install_file(bitmaps/is4.xbm,/etc/athena/login/bitmaps/is4.xbm)
install_file(bitmaps/is5.xbm,/etc/athena/login/bitmaps/is5.xbm)
install_file(bitmaps/menu16,/etc/athena/login/bitmaps/menu16)
install_file(bitmaps/Ctrl-P,/etc/athena/login/bitmaps/Ctrl-P)
install_file(bitmaps/F1,/etc/athena/login/bitmaps/F1)
install_file(bitmaps/F2,/etc/athena/login/bitmaps/F2)
install_file(bitmaps/F3,/etc/athena/login/bitmaps/F3)
install_file(bitmaps/F4,/etc/athena/login/bitmaps/F4)
install_file(bitmaps/F5,/etc/athena/login/bitmaps/F5)
install_file(bitmaps/F6,/etc/athena/login/bitmaps/F6)
install_file(bitmaps/Prev,/etc/athena/login/bitmaps/Prev)
install_file(bitmaps/Shift-F1,/etc/athena/login/bitmaps/Shift-F1)
install_file(bitmaps/Shift-F2,/etc/athena/login/bitmaps/Shift-F2)
install_file(bitmaps/Shift-F3,/etc/athena/login/bitmaps/Shift-F3)
install_file(bitmaps/Shift-F4,/etc/athena/login/bitmaps/Shift-F4)
install_file(bitmaps/Shift-F5,/etc/athena/login/bitmaps/Shift-F5)
install_file(bitmaps/Shift-F6,/etc/athena/login/bitmaps/Shift-F6)
install_file(bitmaps/Shift-F7,/etc/athena/login/bitmaps/Shift-F7)
install_file(bitmaps/Shift-F8,/etc/athena/login/bitmaps/Shift-F8)
install_file(Xlogin,/etc/athena/login/Xlogin)
install_man(timeout.1,timeout.1)
install_man(xlogin.8,xlogin.8)
