# $Id: Imakefile,v 1.20.4.1 1999-11-09 19:23:11 tb Exp $
# Builds xdm and installs it with Athenized config

#ifdef _AIX
OSDEFS= -U_BSD -U_BSD_INCLUDES
#endif
#ifdef SOLARIS
OSDEFS= -DSVR4
#endif
DEFINES= -I. -DTCPCONN -DUNIXCONN -DXDM -DSETPAG $(OSDEFS)
AFSLIBS = -L$(AFSDIR)/lib -L$(AFSDIR)/lib/afs -lprot -lauth -lrxkad \
	-lubik $(AFSDIR)/lib/afs/util.a -laudit -lsys -lrx -llwp -lsys

#ifdef sun
OSLIBS = -lm -lbsd
#endif
#ifdef _IBMR2
OSLIBS = -ls -lodm -lcfg
#endif
#ifdef ultrix
OSLIBS = -lnsyslog
#endif
#ifdef __NetBSD__
OSLIBS = -lcrypt -lutil -lcompat
#endif
#ifdef linux
OSLIBS = -lcrypt -lresolv
#endif

LIBS = -lXaw -lXmu -lXt -lXext -lX11  -lXau -lXdmcp -lal -llocker \
	-lhesiod -lzephyr $(AFSLIBS) -lkrb4 -ldes425 -lkrb5 -lcrypto \
	-lcom_err $(OSLIBS)

OBJS = auth.o daemon.o server.o dpylist.o dm.o error.o file.o \
	greet.o netaddr.o reset.o resource.o protodpy.o policy.o \
	session.o socket.o streams.o util.o verify.o xdmcp.o \
	Login.o mitauth.o genauth.o access.o choose.o \
	athena-verify.o


AnsiCC()
create_dir($(ATHETCDIR))
create_dir($(ATHMANDIR)/man8)
SimpleProgram(xdm,$(OBJS),$(LIBS),$(ATHETCDIR))
install_man(xdm.man,xdm.8)
create_dir($(ATHCONFDIR)/xdm)
install_file(Xresources,$(ATHCONFDIR)/xdm/Xresources)
install_file(xdm-config,$(ATHCONFDIR)/xdm/xdm-config)
install_file(Xservers,$(ATHCONFDIR)/xdm/Xservers)
install_file(Xaccess,$(ATHCONFDIR)/xdm/Xaccess)

athena-verify.c: ../xlogin/verify.c
	rm -f athena-verify.c
	cp ../xlogin/verify.c athena-verify.c

environment.h: ../xlogin/environment.h
	rm -f environment.h
	cp ../xlogin/environment.h environment.h

athena-verify.o: environment.h

#ifdef _AIX
athena-verify.o: athena-verify.c
	$(CC) $(CFLAGS) -D_BSD -D_BSD_INCLUDES -c athena-verify.c
#endif
