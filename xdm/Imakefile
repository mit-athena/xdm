# $Header: /afs/dev.mit.edu/source/repository/athena/etc/xdm/xdm/Imakefile,v 1.7 1992-05-26 17:48:12 epeisach Exp $
# Builds xdm and installs it with Athenized config

#ifdef _AIX
DEFINES= -I. -DTCPCONN -DUNIXCONN -DXDM -U_BSD -U_BSD_INCLUDES
#else
#ifdef ultrix
DEFINES= -I. -DTCPCONN -DUNIXCONN -DXDM
#else
/* Not aix or ultrix.  Must be bsd or sunos */
DEFINES= -I. -DTCPCONN -DUNIXCONN -DX_NOT_POSIX -DX_NOT_STDC_ENV \
	-DXDM -DSIGNALRETURNSINT $(AFSINC)
#endif
#endif

#if defined(UseInstalled)
AFSLIBS = /mit/afsdev/bld/dest/lib/afs/libsys.a
AFSINC = -I/mit/afsdev/bld/dest/include
#else
AFSLIBS = /usr/local/lib/afs/libsys.a
AFSINC = -I/usr/local/include
#endif

#ifdef sun
MACHLIBS = -lm
#endif
#ifdef _IBMR2
MACHLIBS = -ls -lodm -lcfg
#endif
LIBS = -lXaw -lXmu -lXt -lX11  -lXau -lXdmcp -lhesiod -lkrb -ldes $(AFSLIBS) $(MACHLIBS)

OBJS = auth.o daemon.o server.o dpylist.o dm.o error.o file.o \
	greet.o netaddr.o reset.o resource.o protodpy.o policy.o \
	session.o socket.o streams.o util.o verify.o xdmcp.o \
	Login.o mitauth.o genauth.o access.o choose.o \
	athena-verify.o


AnsiCC()
SimpleProgram(xdm,$(OBJS),$(LIBS),$(ATHETCDIR))
install_man(xdm.man,xdm.8)
create_dir($(ATHCONFDIR)/xdm)
install_file(Xresources,$(ATHCONFDIR)/xdm/Xresources)
install_file(xdm-config,$(ATHCONFDIR)/xdm/xdm-config)
install_file(Xservers,$(ATHCONFDIR)/xdm/Xservers)
install_file(Xaccess,$(ATHCONFDIR)/xdm/Xaccess)

athena-verify.c: ../xlogin/verify.c
	rm -f athena-verify.c
	cp ../xlogin/verify.c athena-verify.c

#ifdef _AIX
athena-verify.o: athena-verify.c
	$(CC) $(CFLAGS) -D_BSD -D_BSD_INCLUDES -c athena-verify.c
#endif
