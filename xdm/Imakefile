# $Header: /afs/dev.mit.edu/source/repository/athena/etc/xdm/xdm/Imakefile,v 1.12 1994-07-28 03:46:14 cfields Exp $
# Builds xdm and installs it with Athenized config

#ifdef _AIX
OSDEFS= -U_BSD -U_BSD_INCLUDES
#endif
#if defined(vax) || defined(ibm032) || defined(sun)
OSDEFS= -DX_NOT_POSIX -DX_NOT_STDC_ENV -DSIGNALRETURNSINT
#endif
DEFINES= -I. -DTCPCONN -DUNIXCONN -DXDM $(OSDEFS)
AFSLIBS = $(AFSDIR)/lib/afs/libsys.a

#ifdef sun
OSLIBS = -lm
#endif
#ifdef _IBMR2
OSLIBS = -ls -lodm -lcfg
#endif
#ifdef ultrix
OSLIBS = -lnsyslog
#endif

LIBS = -lXaw -lXmu -lXt -lXext -lX11  -lXau -lXdmcp -lhesiod -lkrb -ldes $(AFSLIBS) $(OSLIBS)

OBJS = auth.o daemon.o server.o dpylist.o dm.o error.o file.o \
	greet.o netaddr.o reset.o resource.o protodpy.o policy.o \
	session.o socket.o streams.o util.o verify.o xdmcp.o \
	Login.o mitauth.o genauth.o access.o choose.o \
	athena-verify.o


AnsiCC()
SimpleProgram(xdm,$(OBJS),$(LIBS),$(ATHETCDIR))
install_man(xdm.man,xdm.8)
create_dir($(ATHCONFDIR)/xdm)
install_file(Xresources,$(ATHCONFDIR)/xdm/Xresources)
install_file(xdm-config,$(ATHCONFDIR)/xdm/xdm-config)
install_file(Xservers,$(ATHCONFDIR)/xdm/Xservers)
install_file(Xaccess,$(ATHCONFDIR)/xdm/Xaccess)

athena-verify.c: ../xlogin/verify.c
	rm -f athena-verify.c
	cp ../xlogin/verify.c athena-verify.c

environment.h: ../xlogin/environment.h
	rm -f environment.h
	cp ../xlogin/environment.h environment.h

athena-verify.o: environment.h

#ifdef _AIX
athena-verify.o: athena-verify.c
	$(CC) $(CFLAGS) -D_BSD -D_BSD_INCLUDES -c athena-verify.c
#endif
